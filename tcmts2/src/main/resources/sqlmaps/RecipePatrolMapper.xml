<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tangu.tcmts.dao.RecipePatrolMapper" >
  <resultMap id="BaseResultMap" type="com.tangu.tcmts.po.RecipePatrol" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="recipe_id" property="recipeId" jdbcType="INTEGER" />
    <result column="operate_id" property="operateId" jdbcType="INTEGER" />
    <result column="operate_type" property="operateType" jdbcType="INTEGER" />
    <result column="operate_comment" property="operateComment" jdbcType="VARCHAR" />
    <result column="actual_amount" property="actualAmount" jdbcType="DECIMAL" />
    <result column="actual_kind" property="actualKind" jdbcType="INTEGER" />
    <result column="patrol_result" property="patrolResult" jdbcType="VARCHAR" />
    <result column="patrol_status" property="patrolStatus" jdbcType="INTEGER" />
    <result column="plan_amount" property="planAmount" jdbcType="DECIMAL" />
    <result column="operate_time" property="operateTime" jdbcType="TIMESTAMP" />
  </resultMap>

  <select id="listRecipePatrols" resultMap="BaseResultMap" parameterType="com.tangu.tcmts.po.RecipePatrol" >
    SELECT
    rp.id,recipe_code,r.create_time,hospital_company AS hospital_name,recipient_name,doctor_name,
    quantity,plan_amount,actual_amount,medicine_quantity,actual_kind,patrol_result,r.recipe_serial as recipe_serial,
    operate_comment,actual_boil_time,machine_code,patrol_status,operate_type,r.sys_recipe_code,operate_time,
    ee.employee_name AS dispense_name,e.employee_name AS operator,eee.employee_name AS decocting_member
    FROM recipe_patrol rp LEFT JOIN recipe r ON rp.recipe_id = r.id
	LEFT JOIN employee e ON rp.operate_id = e.id
	LEFT JOIN employee ee ON r.dispense_id = ee.id
	LEFT JOIN employee eee ON r.boil_id = eee.id
	LEFT JOIN hospital h ON r.hospital_id = h.id
    <where>
      <if test="patrolStatus == null">
        AND patrol_status != 999
      </if>
      <if test="startDate != null and endDate != null">
        AND operate_time BETWEEN #{startDate} AND #{endDate}
      </if>
      <if test="patrolStatus != null">
        AND patrol_status = #{patrolStatus}
      </if>
      <if test="hospitalId != null">
        AND r.hospital_id = #{hospitalId}
      </if>
      <if test="sysRecipeCode != null and sysRecipeCode != ''">
        AND r.sys_recipe_code LIKE CONCAT('%',#{sysRecipeCode},'%')
      </if>
      <if test="recipientName != null and recipientName != '' ">
        AND recipient_name like CONCAT('%', #{recipientName},'%')
      </if>
      <if test="quantity != null and quantity != ''">
        AND quantity = #{quantity}
      </if>
      <if test="operateType != null">
        AND operate_type = #{operateType}
      </if>
    </where>
  </select>
  <insert id="insert" parameterType="com.tangu.tcmts.po.RecipePatrol" >
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into recipe_patrol (recipe_id, operate_id, operate_type, 
      operate_comment, actual_amount, actual_kind, 
      patrol_result, patrol_status, plan_amount, 
      operate_time)
    values (#{recipeId,jdbcType=INTEGER}, #{operateId,jdbcType=INTEGER}, #{operateType,jdbcType=INTEGER}, 
      #{operateComment,jdbcType=VARCHAR}, #{actualAmount,jdbcType=DECIMAL}, #{actualKind,jdbcType=INTEGER}, 
      #{patrolResult,jdbcType=VARCHAR}, #{patrolStatus,jdbcType=INTEGER}, #{planAmount,jdbcType=DECIMAL}, 
      #{operateTime,jdbcType=TIMESTAMP})
  </insert>
  <insert id="insertSelective" parameterType="com.tangu.tcmts.po.RecipePatrol" >
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into recipe_patrol
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="recipeId != null" >
        recipe_id,
      </if>
      <if test="operateId != null" >
        operate_id,
      </if>
      <if test="operateType != null" >
        operate_type,
      </if>
      <if test="operateComment != null" >
        operate_comment,
      </if>
      <if test="actualAmount != null" >
        actual_amount,
      </if>
      <if test="actualKind != null" >
        actual_kind,
      </if>
      <if test="patrolResult != null" >
        patrol_result,
      </if>
      <if test="patrolStatus != null" >
        patrol_status,
      </if>
      <if test="planAmount != null" >
        plan_amount,
      </if>
      <if test="operateTime != null" >
        operate_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="recipeId != null" >
        #{recipeId,jdbcType=INTEGER},
      </if>
      <if test="operateId != null" >
        #{operateId,jdbcType=INTEGER},
      </if>
      <if test="operateType != null" >
        #{operateType,jdbcType=INTEGER},
      </if>
      <if test="operateComment != null" >
        #{operateComment,jdbcType=VARCHAR},
      </if>
      <if test="actualAmount != null" >
        #{actualAmount,jdbcType=DECIMAL},
      </if>
      <if test="actualKind != null" >
        #{actualKind,jdbcType=INTEGER},
      </if>
      <if test="patrolResult != null" >
        #{patrolResult,jdbcType=VARCHAR},
      </if>
      <if test="patrolStatus != null" >
        #{patrolStatus,jdbcType=INTEGER},
      </if>
      <if test="planAmount != null" >
        #{planAmount,jdbcType=DECIMAL},
      </if>
      <if test="operateTime != null" >
        #{operateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.tangu.tcmts.po.RecipePatrol" >
    update recipe_patrol
    <set >
      <if test="recipeId != null" >
        recipe_id = #{recipeId,jdbcType=INTEGER},
      </if>
      <if test="operateId != null" >
        operate_id = #{operateId,jdbcType=INTEGER},
      </if>
      <if test="operateType != null" >
        operate_type = #{operateType,jdbcType=INTEGER},
      </if>
      <if test="operateComment != null" >
        operate_comment = #{operateComment,jdbcType=VARCHAR},
      </if>
      <if test="actualAmount != null" >
        actual_amount = #{actualAmount,jdbcType=DECIMAL},
      </if>
      <if test="actualKind != null" >
        actual_kind = #{actualKind,jdbcType=INTEGER},
      </if>
      <if test="patrolResult != null" >
        patrol_result = #{patrolResult,jdbcType=VARCHAR},
      </if>
      <if test="patrolStatus != null" >
        patrol_status = #{patrolStatus,jdbcType=INTEGER},
      </if>
      <if test="planAmount != null" >
        plan_amount = #{planAmount,jdbcType=DECIMAL},
      </if>
      <if test="operateTime != null" >
        operate_time = #{operateTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updatePatrolStatus" parameterType="java.lang.Integer">
    UPDATE recipe_patrol
    SET patrol_status = 999
    WHERE id=#{id}
  </update>
  <insert id="addRecipePatrol" parameterType="com.tangu.tcmts.po.RecipePatrol" >
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into recipe_patrol
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="recipeId != null" >
        recipe_id,
      </if>
      <if test="operateId != null" >
        operate_id,
      </if>
      <if test="operateType != null" >
        operate_type,
      </if>
      <if test="operateComment != null" >
        operate_comment,
      </if>
      <if test="actualAmount != null" >
        actual_amount,
      </if>
      <if test="actualKind != null" >
        actual_kind,
      </if>
      <if test="patrolResult != null" >
        patrol_result,
      </if>
      <if test="patrolStatus != null" >
        patrol_status,
      </if>
      <if test="planAmount != null" >
        plan_amount,
      </if>
      <if test="operateTime != null" >
        operate_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="recipeId != null" >
        #{recipeId,jdbcType=INTEGER},
      </if>
      <if test="operateId != null" >
        #{operateId,jdbcType=INTEGER},
      </if>
      <if test="operateType != null" >
        #{operateType,jdbcType=INTEGER},
      </if>
      <if test="operateComment != null" >
        #{operateComment,jdbcType=VARCHAR},
      </if>
      <if test="actualAmount != null" >
        #{actualAmount,jdbcType=DECIMAL},
      </if>
      <if test="actualKind != null" >
        #{actualKind,jdbcType=INTEGER},
      </if>
      <if test="patrolResult != null" >
        #{patrolResult,jdbcType=VARCHAR},
      </if>
      <if test="patrolStatus != null" >
        #{patrolStatus,jdbcType=INTEGER},
      </if>
      <if test="planAmount != null" >
        #{planAmount,jdbcType=DECIMAL},
      </if>
      <if test="operateTime != null" >
        #{operateTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
</mapper>