<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tangu.tcmts.dao.SettleCompanyMapper" >
  <resultMap id="BaseResultMap" type="com.tangu.tcmts.po.SettleCompanyDO" >
    <id column="id" property="id" jdbcType="INTEGER" />
    <result column="settle_company_name" property="settleCompanyName" jdbcType="VARCHAR" />
    <result column="initial_code" property="initialCode" jdbcType="VARCHAR" />
    <result column="price_type_id" property="priceTypeId" jdbcType="INTEGER" />
    <result column="discount" property="discount" jdbcType="DECIMAL" />
    <result column="tax_rate" property="taxRate" jdbcType="DECIMAL" />
    <result column="process_cost" property="processCost" jdbcType="DECIMAL" />
    <result column="fee_rate" property="feeRate" jdbcType="DECIMAL" />
    <result column="sale_employee_id" property="saleEmployeeId" jdbcType="INTEGER" />
    <result column="realtime_stock" property="realtimeStock" jdbcType="INTEGER" />
    <result column="packing" property="packing" jdbcType="VARCHAR" />
    <result column="remark" property="remark" jdbcType="VARCHAR" />
    <result column="use_state" property="useState" jdbcType="BIT" />
    <result column="create_time" property="createTime" jdbcType="TIMESTAMP" />
    <result column="mod_user" property="modUser" jdbcType="INTEGER" />
    <result column="mod_time" property="modTime" jdbcType="TIMESTAMP" />
  </resultMap>
  <select id="listSettleCompanys" resultMap="BaseResultMap" parameterType="com.tangu.tcmts.po.SettleCompanyDTO" >
    select
    sc.id, settle_company_name, discount, tax_rate,
    IFNULL(sc.process_cost,0) as process_cost,IFNULL(sc.fee_rate,0) as fee_rate,
    remark, sc.use_state,pt.templet_name AS priceTypeName
    FROM settle_company sc LEFT JOIN price_templet pt ON sc.price_type_id=pt.id
    <where>
      <if test="settleCompanyName != null">
      AND settle_company_name like CONCAT('%',#{settleCompanyName},'%')
      </if>
      <if test="priceTypeId != null">
       AND price_type_id = #{priceTypeId}
      </if>
      <if test="useState != null">
       AND sc.use_state = #{useState}
      </if>
    </where>
      ORDER BY sc.create_time DESC
  </select>
  <select id="getSettleCompanyContent" resultType="com.tangu.tcmts.po.SettleCompanyDO" parameterType="java.lang.Integer">
    SELECT
    sc.id, settle_company_name,price_type_id, discount, tax_rate,
    IFNULL(sc.process_cost,0) as process_cost,IFNULL(sc.fee_rate,0) as fee_rate,
    sale_employee_id,realtime_stock, packing, remark, sc.use_state, sc.create_time,
    sc.mod_user, sc.mod_time,pt.templet_name AS priceTypeName
    FROM settle_company sc LEFT JOIN price_templet pt ON sc.price_type_id=pt.id
    WHERE sc.id=#{id}
  </select>
  <select id="getRepeatSettleCompanyName" resultMap="BaseResultMap" parameterType="com.tangu.tcmts.po.SettleCompanyDTO">
    SELECT settle_company_name
    FROM settle_company
    WHERE
      settle_company_name = #{settleCompanyName}
    <if test="id != null">
      AND id != #{id}
    </if>
  </select>
  <insert id="insertSettleCompany" parameterType="com.tangu.tcmts.po.SettleCompanyDO" >
    <selectKey resultType="java.lang.Integer" keyProperty="id" order="AFTER" >
      SELECT LAST_INSERT_ID()
    </selectKey>
    insert into settle_company
    <trim prefix="(" suffix=")" suffixOverrides="," >
      <if test="settleCompanyName != null" >
        settle_company_name,
      </if>
      <if test="initialCode != null" >
        initial_code,
      </if>
      <if test="priceTypeId != null" >
        price_type_id,
      </if>
      <if test="discount != null" >
        discount,
      </if>
      <if test="taxRate != null" >
        tax_rate,
      </if>
      <if test="processCost != null" >
        process_cost,
      </if>
      <if test="feeRate != null" >
        fee_rate,
      </if>
      <if test="saleEmployeeId != null" >
        sale_employee_id,
      </if>
      <if test="realtimeStock != null" >
        realtime_stock,
      </if>
      <if test="packing != null" >
        packing,
      </if>
      <if test="remark != null" >
        remark,
      </if>
      <if test="useState != null" >
        use_state,
      </if>
      <if test="createTime != null" >
        create_time,
      </if>
      <if test="modUser != null" >
        mod_user,
      </if>
      <if test="modTime != null" >
        mod_time,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides="," >
      <if test="settleCompanyName != null" >
        #{settleCompanyName,jdbcType=VARCHAR},
      </if>
      <if test="initialCode != null" >
        #{initialCode,jdbcType=VARCHAR},
      </if>
      <if test="priceTypeId != null" >
        #{priceTypeId,jdbcType=INTEGER},
      </if>
      <if test="discount != null" >
        #{discount,jdbcType=DECIMAL},
      </if>
      <if test="taxRate != null" >
        #{taxRate,jdbcType=DECIMAL},
      </if>
      <if test="processCost != null" >
        #{processCost,jdbcType=DECIMAL},
      </if>
      <if test="feeRate != null" >
        #{feeRate,jdbcType=DECIMAL},
      </if>
      <if test="saleEmployeeId != null" >
        #{saleEmployeeId,jdbcType=INTEGER},
      </if>
      <if test="realtimeStock != null" >
        #{realtimeStock,jdbcType=INTEGER},
      </if>
      <if test="packing != null" >
        #{packing,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        #{remark,jdbcType=VARCHAR},
      </if>
      <if test="useState != null" >
        #{useState,jdbcType=BIT},
      </if>
      <if test="createTime != null" >
        #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modUser != null" >
        #{modUser,jdbcType=INTEGER},
      </if>
      <if test="modTime != null" >
        #{modTime,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateSettleCompany" parameterType="com.tangu.tcmts.po.SettleCompanyDO" >
    update settle_company
    <set >
      <if test="settleCompanyName != null" >
        settle_company_name = #{settleCompanyName,jdbcType=VARCHAR},
      </if>
      <if test="initialCode != null" >
        initial_code = #{initialCode,jdbcType=VARCHAR},
      </if>
      <if test="priceTypeId != null" >
        price_type_id = #{priceTypeId,jdbcType=INTEGER},
      </if>
      <if test="discount != null" >
        discount = #{discount,jdbcType=DECIMAL},
      </if>
      <if test="taxRate != null" >
        tax_rate = #{taxRate,jdbcType=DECIMAL},
      </if>
      <if test="processCost != null" >
        process_cost = #{processCost,jdbcType=DECIMAL},
      </if>
      <if test="feeRate != null" >
        fee_rate = #{feeRate,jdbcType=DECIMAL},
      </if>
      <if test="saleEmployeeId != null" >
        sale_employee_id = #{saleEmployeeId,jdbcType=INTEGER},
      </if>
      <if test="realtimeStock != null" >
        realtime_stock = #{realtimeStock,jdbcType=INTEGER},
      </if>
      <if test="packing != null" >
        packing = #{packing,jdbcType=VARCHAR},
      </if>
      <if test="remark != null" >
        remark = #{remark,jdbcType=VARCHAR},
      </if>
      <if test="useState != null" >
        use_state = #{useState,jdbcType=BIT},
      </if>
      <if test="createTime != null" >
        create_time = #{createTime,jdbcType=TIMESTAMP},
      </if>
      <if test="modUser != null" >
        mod_user = #{modUser,jdbcType=INTEGER},
      </if>
      <if test="modTime != null" >
        mod_time = #{modTime,jdbcType=TIMESTAMP},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateUseState" parameterType="com.tangu.tcmts.po.SettleCompanyDTO">
    UPDATE settle_company
    SET use_state=#{useState},
        mod_user=#{modUser},
        mod_time=#{modTime}
    WHERE id=#{id}
  </update>
</mapper>