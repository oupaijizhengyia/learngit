<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tangu.tcmts.dao.MedicinePriceHistoryMapper">
	<resultMap id="BaseResultMap" type="com.tangu.tcmts.po.MedicinePriceHistoryDO">
	</resultMap>

	<select id="listHistory" parameterType="com.tangu.tcmts.po.MedicinePriceHistoryDTO"
		resultType="com.tangu.tcmts.po.MedicinePriceHistoryDO">
		SELECT mph.id,
		mph.create_time,m.`medicine_name`,mph.price_type,templet_name,mph.now_trade_price,mph.now_retail_price
		,e.`employee_name` AS creatorName,mph.effective_date
		FROM `medicine_price_history` mph
		INNER JOIN `medicine` m ON m.`id`=mph.`medicine_id`
		INNER JOIN `employee` e ON e.`id`=mph.`creator_id`
		INNER JOIN `price_templet` pt ON pt.`id` = mph.`price_type`
		<where>
			<if test="startDate!=null and endDate !=null ">
				UNIX_TIMESTAMP(mph.create_time) >= UNIX_TIMESTAMP(#{startDate}) 
				AND
				UNIX_TIMESTAMP(DATE_FORMAT(mph.create_time,'%y-%m-%d')) 
				&lt;= UNIX_TIMESTAMP(DATE_FORMAT(#{endDate},'%y-%m-%d')) 
			</if>
			<if test="medicineName != null and medicineName != '' ">
				AND ( m.medicine_name LIKE CONCAT('%',#{medicineName},'%')
				or m.initial_code LIKE CONCAT('%',#{medicineName},'%')
				or m.mnemonic_code LIKE CONCAT('%',#{medicineName},'%')
				)
			</if>
			<if test="priceType != null and priceType != '' ">
				AND mph.price_type =#{priceType}
			</if>
		</where>
		ORDER BY mph.create_time DESC
		limit 1000
	</select>
</mapper>