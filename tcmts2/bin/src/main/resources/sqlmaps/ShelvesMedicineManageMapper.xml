<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.tangu.tcmts.dao.ShelvesMedicineManageMapper" >

  <resultMap id="BaseResultMap" type="com.tangu.tcmts.po.ShelvesMedicineDTO"></resultMap>


  <select id="listShelvesMedicineDTOByCondition" resultMap="BaseResultMap" parameterType="com.tangu.tcmts.po.ShelvesMedicineManage">
    SELECT 
    	r.id AS recipe_id,rp.shelve_time AS shelves_time,r.shelves_code,ms.shelves_type,r.sys_recipe_code,
    	r.invoice_code,r.recipient_name,
    	r.consignee_tel AS consignee_tel,r.take_time 
    FROM recipe r 
    LEFT JOIN medicine_shelves ms ON r.shelves_code=ms.shelves_code
    ,recipe_proccess rp
    WHERE r.id=rp.recipe_id AND r.shipping_state=95
    <if test="shelvesCode != null and shelvesCode != ''">
      AND r.shelve_code = #{shelvesCode}
    </if>
    <if test="invoiceCode != null and invoiceCode != ''">
      AND r.invoice_code = #{invoiceCode}
    </if>
    <if test="recipientName != null and recipientName != ''">
      AND r.recipient_name = #{recipientName}
    </if>
    <if test="shelvesType != 0 and shelvesType != null">
    AND ms.shelves_type = #{shelvesType}
    </if>
    <if test="sysRecipeCode != null and sysRecipeCode != ''">
      AND r.sys_recipe_code = #{sysRecipeCode}
    </if>
    ORDER BY rp.shelve_time
  </select>


</mapper>